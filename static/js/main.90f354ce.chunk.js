(this["webpackJsonpsydney-advertising-map"]=this["webpackJsonpsydney-advertising-map"]||[]).push([[0],{101:function(e,t,o){"use strict";o.r(t);var a=o(33),r=o(0),n=o.n(r),l=(o(44),o(3)),c=o.n(l),i=o(10),s=o(11),u=o(2),d=o.n(u),y=(o(46),o(34));function p(e,t,o){e.addLayer({id:t,type:"fill",source:"osm2streets-vector-tileserver","source-layer":"lanePolygons",paint:o,filter:["==","type",t]},void 0)}var f="white",g="#666666",m="grey",h="#CCCCCC",v="#CCCCCC",w="#0F7D4B",b="#BE4A4C",k="#FF6D00",C="#DDDDE8",S=(o(47),o(35)),j=o.n(S),E=(o(77),o(36)),R=o.n(E),x=o(37);function O(e){var t=e.properties;return null!==t&&("primary"===t.highway&&void 0===t.maxspeed||(t.maxspeed>40||"residential"===t.highway&&void 0===t.maxspeed))}function _(e){var t=e.properties;return null!==t&&(t.maxspeed<=40||"lane"===t.cycleway)}function L(e){var t=e.properties;return null!==t&&(t.maxspeed<=30||("cycleway"===t.highway||("shared_lane"===t.highway||("designated"===t.bicycle&&"cycleway"===t.highway||("living_street"===t.highway||("track"===t.cycleway||"track"===t["cycleway:left"]||"track"===t["cycleway:right"]))))))}function F(e){try{console.log("Removing sources..."),e.removeLayer("greenRoadsId"),e.removeLayer("redRoadsId"),e.removeLayer("orangeRoadsId"),e.removeSource("greenRoads"),e.removeSource("redRoads"),e.removeSource("orangeRoads")}catch(t){console.log("not removing sources - at least one doesn't exist yet")}}function D(e,t){e.addSource("redRoads",{type:"geojson",data:{features:t.features.filter(O),type:"FeatureCollection"}}),e.addSource("orangeRoads",{type:"geojson",data:{features:t.features.filter(_),type:"FeatureCollection"}}),e.addSource("greenRoads",{type:"geojson",data:{features:t.features.filter(L),type:"FeatureCollection"}}),e.addLayer({id:"redRoadsId",type:"line",source:"redRoads",layout:{},paint:{"line-color":"red","line-width":3,"line-opacity":.3}},"SharedUse"),e.addLayer({id:"orangeRoadsId",type:"line",source:"orangeRoads",layout:{},paint:{"line-color":"orange","line-width":3,"line-opacity":.5}},"SharedUse"),e.addLayer({id:"greenRoadsId",type:"line",source:"greenRoads",layout:{},paint:{"line-color":"#00FF00","line-width":7,"line-opacity":.8}},"SharedUse")}var I=function(e){return"\n[out:json][timeout:60][bbox:".concat(e,']; \n\n/* Select road types to display */ \n\n( \n  way[highway];\n  way["highway"="residential"];\n  \n  way[highway=cycleway];\n  way["highway"~"cycleway|path|footway|pedestrian"]["bicycle"~"yes|designated"];\n  way[highway=proposed][proposed=cycleway];\n  way[highway=construction][construction=cycleway];\n  way[proposed=cycleway];\n  way[cycleway=lane];\n  way["cycleway:left"=track];\n  way[cycleway=track];\n\n);\n\n// print results \nout body; \n>; \nout skel qt; \n')},M=o(38),z=o.n(M);function P(e){return A.apply(this,arguments)}function A(){return(A=Object(i.a)(c.a.mark((function e(t){var o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={hostname:"overpass.kumi.systems",port:443,path:"/api/interpreter",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}},e.abrupt("return",new Promise((function(e,a){var r=x.request(o,(function(t){var o="";t.setEncoding("utf8"),t.on("data",(function(e){return o+=e})),t.on("end",(function(){200!==t.statusCode&&(console.log("error code",t.statusCode),a(t.statusCode));var r=JSON.parse(o);e(r)}))}));r.on("error",(function(e){a(e.message)})),r.write(new URLSearchParams({data:t}).toString()),r.end()})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=R()((function(e,t,o){return T.apply(this,arguments)}),2e3);function T(){return(T=Object(i.a)(c.a.mark((function e(t,o,a){var r,n,l,i,s,u,d,y,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a("loading"),r=t.getBounds(),n=r.getSouth(),l=r.getWest(),i=r.getNorth(),s=r.getEast(),d=[n,l,i,s].join(","),y=I(d),console.log("Started POST request..."),e.prev=11,e.next=14,P(y);case 14:u=e.sent,e.next=22;break;case 17:return e.prev=17,e.t0=e.catch(11),console.log("Error:",e.t0),a("unknownerror"),e.abrupt("return");case 22:p=z()(u,{}),console.log(p),console.log("Adding geojson to map..."),F(t),D(t,p),a("success");case 28:case"end":return e.stop()}}),e,null,[[11,17]])})))).apply(this,arguments)}function J(){var e=n.a.useRef(null),t=n.a.useRef(null),o=n.a.useRef([]),a=Object(r.useState)("ready_to_load"),l=Object(s.a)(a,2),u=l[0],S=l[1],E=Object(r.useState)(151.2160755932166),R=Object(s.a)(E,2),x=R[0],O=R[1],_=Object(r.useState)(-33.88056647217827),L=Object(s.a)(_,2),F=L[0],D=L[1],I=Object(r.useState)(17.504322191852786),M=Object(s.a)(I,2),z=M[0],P=M[1];Object(r.useEffect)((function(){if(null!==e.current&&null===t.current){t.current=new d.a.Map({container:e.current,center:[x,F],zoom:z,hash:!0,style:"mapbox://styles/mapbox/dark-v11"});var a=t.current;a.on("load",function(e){return function(){var t,o,a=e.getStyle().layers,r=Object(y.a)(a);try{for(r.s();!(o=r.n()).done;){var n=o.value;if("symbol"===n.type){t=n.id;break}}}catch(l){r.e(l)}finally{r.f()}console.log({firstSymbolId:t}),console.log("Adding sources. If you don't seen anything check vector server logs."),e.addSource("osm2streets-vector-tileserver",{type:"vector",tiles:["https://api.safecyclingmap.com/tile/{z}/{x}/{y}"],minzoom:17,maxzoom:19}),p(e,"SharedUse",{"fill-color":"blue","fill-opacity":.3}),p(e,"Shoulder",{"fill-color":v,"fill-opacity":.5}),p(e,"Sidewalk",{"fill-color":h,"fill-opacity":.9}),p(e,"Footway",{"fill-color":C,"fill-opacity":.9}),p(e,"Driving",{"fill-color":m,"fill-opacity":.9}),p(e,"Bus",{"fill-color":b,"fill-opacity":.9}),p(e,"Construction",{"fill-color":k,"fill-opacity":.5}),e.addLayer({id:"intersection",type:"fill",source:"osm2streets-vector-tileserver","source-layer":"geometry",paint:{"fill-color":g,"fill-opacity":1},filter:["==","type","intersection"]},void 0),e.addLayer({id:"Biking",type:"fill",source:"osm2streets-vector-tileserver","source-layer":"lanePolygons",paint:{"fill-color":w,"fill-opacity":1},filter:["==","type","Biking"]},void 0),e.addLayer({id:"intersectionMarkings",type:"fill",source:"osm2streets-vector-tileserver","source-layer":"intersectionMarkings",paint:{"fill-color":m,"fill-opacity":.8},filter:["==","$type","Polygon"]},void 0),e.addLayer({id:"laneMarkings",type:"fill",source:"osm2streets-vector-tileserver","source-layer":"laneMarkings",paint:{"fill-color":f,"fill-opacity":1},filter:["==","$type","Polygon"]},void 0)}}(a)),a.addControl(new d.a.NavigationControl),a.addControl(new d.a.FullscreenControl),a.addControl(new j.a({accessToken:d.a.accessToken,mapboxgl:d.a}),"top-left"),a.addControl(new d.a.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),a.on("move",(function(){if(a){var e=a.getCenter(),t=e.lng,o=e.lat,r=a.getZoom();S(r<15?"too_zoomed_out":"ready_to_load"),console.log(t,o,r),O(a.getCenter().lng),D(a.getCenter().lat),P(a.getZoom())}})),a.getZoom()<15?S("too_zoomed_out"):(console.log("zoom is ".concat(a.getZoom())),B(a,o,S)),a.on("moveend",Object(i.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==a){e.next=2;break}return e.abrupt("return");case 2:(t=a.getZoom())>15&&(console.log("zoom is ".concat(t)),B(a,o,S));case 4:case"end":return e.stop()}}),e)}))))}}));var A={loading:"Loading from OpenStreetMap...",success:"Done loading",ready_to_load:"About to load...",too_zoomed_out:"Zoom in to see street safety",unknownerror:"Error loading. Please wait a bit","429error":"Too many requests, please try in a bit"}[u];return n.a.createElement("div",null,n.a.createElement("div",{className:"sidebar"},n.a.createElement("label",null,n.a.createElement("span",{color:"red"},"Warning:")," Data is open source and not guaranteed to be accurate.",n.a.createElement("br",null),n.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/jakecoppinger/safe-cycling-map/blob/main/key.md"},"View map key and how safety is calculated"),n.a.createElement("br",null),n.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/jakecoppinger/safe-cycling-map"},"About this map"),n.a.createElement("br",null),A)),n.a.createElement("div",{ref:e,className:"map-container"}))}d.a.accessToken="pk.eyJ1IjoiamFrZWMiLCJhIjoiY2tkaHplNGhjMDAyMDJybW4ybmRqbTBmMyJ9.AR_fnEuka8-cFb4Snp3upw";var Z=function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement(J,null))};Object(a.render)(n.a.createElement(Z,null),document.getElementById("root"))},39:function(e,t,o){e.exports=o(101)},44:function(e,t,o){},46:function(e,t,o){},82:function(e,t){},84:function(e,t){}},[[39,1,2]]]);
//# sourceMappingURL=main.90f354ce.chunk.js.map